---
title: "Modsoccs Data Reformat"
output: html_notebook
---

```{r}
library(dplyr)

```


```{r}
# read in Modsoccs data
mod_df <- read.csv("/projects/loliver/ModSoCCS/data/raw/SPN20Neuromodulation_DATA_2022-10-24.csv")

# keep demo, diagnosis, BPRS, CDSS, SANS, WTAR from screening and QLS, neurocog (no composite score recorded), and soc cog from baseline
mod_base <- merge(mod_df[mod_df$redcap_event_name=="screening_arm_1",c(1,5,16:69,195:207,244,461:463,510:515,535,590:594,655:656)],
                mod_df[mod_df$redcap_event_name=="baseline_arm_1",c(1,709:713,737:745,756:758,775:781,786:788)], by="record_id")
colnames(mod_base)[93:114] <- paste("pre",colnames(mod_base)[93:114],sep="_")
colnames(mod_base)[2] <- "site"

# merge with follow-up data
mod_data <- merge(mod_base,mod_df[mod_df$redcap_event_name=="followup_arm_1",c(1,737:745,756:758,775:781,786:788,801,803)], by="record_id")
mod_data <- mod_data[,c(1:2,137:138,3:136)]
colnames(mod_data)[117:138] <- paste("post",colnames(mod_data)[117:138],sep="_")

# recode site, sex, handedness, and SSD disorder type
mod_data$site <- as.factor(mod_data$site)
mod_data$demo_sex_birth <- as.factor(ifelse(mod_data$demo_sex_birth == 1, 'female', 'male'))
mod_data$demo_hand <- as.factor(ifelse(mod_data$demo_hand == 1, 'left', 'right')) # no 3s

as.character(mod_data$scid5_cat3_scz)
mod_data$scid5_cat3_scz <- recode(mod_data$scid5_cat3_scz,
  '13' = "Schizophrenia",
  '14' = "Schizophreniform Disorder",
  '15' = "Schizoaffective Disorder",
  '16' = "Delusional Disorder",
  '17' = "Brief Psychotic Disorder",
  '18' = "Psychotic Disorder due to Another Medical Cond",
  '19' = "Substance-induced Psychotic Disorder",
  '20' = "Other Specified Psychotic Disorder")

#as.character(mod_data$scid5_principal_dx) # not sure how these align wtih the categories - there are values greater than 12
#mod_data$scid5_principal_dx <- recode(mod_data$scid5_principal_dx,
#  '1' = "Bipolar and Related Disorders",
#  '2' = "Depressive Disorders",
#  '3' = "Schizophrenia & Psychotic Disorders",
#  '4' = "Substance Use Disorders",
#  '5' = "Anxiety Disorders",
#  '6' = "Obsessive-Compulsive & Related Disorders",
#  '7' = "Sleep-Wake Disorders",
#  '8' = "Feeding & Eating Disorders",
#  '9' = "Somatic Symptom & Related Disorders",
#  '10' = "Externalizing Disorders",
#  '11' = "Trauma & Stress-Related Disorders",
#  '12' = "Other DSM-5 Disorder")

# read in IDs for those with target coordinates and create variable to indicate who was randomized
mod_rand <- read.csv("/projects/loliver/ModSoCCS/data/behavioural/ModSoCCS_Target_IDs_10-24-2022.csv")
mod_data$randomized <- ifelse(mod_data$record_id %in% mod_rand$record_id, 1, 0)

mod_data <- mod_data[,c(1:2,139,3:138)]

# change tasit 0s to NAs for ZHP0023 (scores not entered for follow-up yet) ## check for other participants with all 0s for TASIT ##
mod_data[mod_data$record_id=="SPN20_ZHP_0023",130:139] <- NA

#mod_data[mod_data$term_premature_yn==0,]

# write out a new csv
#write.csv(mod_data, '/projects/loliver/ModSoCCS/data/behavioural/ModSoCCS_data_10-24-2022.csv', row.names = FALSE)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
